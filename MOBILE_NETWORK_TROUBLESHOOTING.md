# 移动端网络连接问题解决指南

## 问题现象

APK安装后无法访问后端服务器，可能出现以下情况：
- 应用启动后显示网络错误
- 数据无法加载
- 登录失败
- API请求超时

## 常见原因和解决方案

### 1. IP地址不匹配

**问题**：应用中硬编码的IP地址在用户网络环境中不可达

**解决方案**：
- 使用应用内的网络设置功能
- 在设置页面测试并选择可用的服务器地址
- 应用会自动检测并缓存可用的API地址

### 2. 网络权限问题

**问题**：Android应用没有网络访问权限

**解决方案**：
- 检查应用权限设置
- 确保允许应用访问网络
- 重新安装应用并授予所有必要权限

### 3. 防火墙阻止

**问题**：设备或路由器防火墙阻止了连接

**解决方案**：
- 检查手机的防火墙设置
- 检查路由器的防火墙配置
- 临时关闭防火墙进行测试

### 4. 网络环境不同

**问题**：手机和服务器不在同一网络

**解决方案**：
- 确保手机连接到与服务器相同的WiFi网络
- 检查网络设置，确保设备可以互相访问
- 使用网络扫描工具查找服务器IP

## 使用应用内诊断工具

### 网络诊断功能

1. **打开设置页面**
   - 在应用中找到"设置"或"网络设置"
   - 点击进入网络配置页面

2. **运行连接测试**
   - 点击"测试所有连接"按钮
   - 等待测试完成，查看结果
   - 选择状态为"可用"的地址

3. **手动配置地址**
   - 如果自动检测失败，可以手动输入服务器地址
   - 格式：`http://IP地址:8000`
   - 点击"测试连接"验证
   - 保存设置

### 常见服务器地址

根据网络环境，服务器可能在以下地址：

- `http://192.168.1.100:8000` - 常见家庭网络
- `http://192.168.0.100:8000` - 另一种家庭网络配置
- `http://192.168.79.13:8000` - 原始配置地址
- `http://10.0.2.2:8000` - Android模拟器环境
- `http://172.16.x.x:8000` - 企业网络环境

## 服务器端配置检查

### 1. 确保服务器运行

```bash
# 检查服务器是否运行
curl http://localhost:8000/health

# 检查端口是否开放
netstat -an | grep 8000
```

### 2. 检查防火墙设置

```bash
# Ubuntu/Debian
sudo ufw status
sudo ufw allow 8000

# CentOS/RHEL
sudo firewall-cmd --list-ports
sudo firewall-cmd --add-port=8000/tcp --permanent
```

### 3. 检查服务器绑定地址

确保后端服务绑定到 `0.0.0.0:8000` 而不是 `127.0.0.1:8000`

## 网络环境检查

### 1. 获取服务器IP地址

```bash
# 在服务器上运行
ip addr show
# 或
ifconfig
```

### 2. 测试网络连通性

在手机上使用网络工具（如Network Analyzer）：
- 扫描局域网设备
- 查找开放的8000端口
- 测试连接延迟

### 3. 检查路由器设置

- 确保AP隔离功能已关闭
- 检查访客网络设置
- 确认设备在同一子网

## 高级解决方案

### 1. 使用动态IP检测

应用已集成智能IP检测功能：
- 自动测试多个可能的服务器地址
- 缓存可用的地址供后续使用
- 在后台持续监控连接状态

### 2. 配置HTTPS（推荐生产环境）

```bash
# 使用Let's Encrypt获取SSL证书
sudo certbot --nginx -d yourdomain.com

# 更新应用配置使用HTTPS
# 在网络设置中输入：https://yourdomain.com
```

### 3. 使用VPN或端口转发

如果无法直接连接：
- 配置VPN连接到服务器网络
- 设置端口转发规则
- 使用ngrok等隧道服务

## 故障排除步骤

1. **基础检查**
   - 确认WiFi连接正常
   - 检查应用权限设置
   - 重启应用和设备

2. **网络测试**
   - 使用应用内诊断工具
   - 测试多个可能的服务器地址
   - 记录测试结果

3. **服务器验证**
   - 确认服务器正在运行
   - 检查服务器日志
   - 验证防火墙设置

4. **高级诊断**
   - 使用网络分析工具
   - 检查路由器配置
   - 考虑网络拓扑问题

## 联系支持

如果以上方法都无法解决问题，请提供以下信息：
- 网络环境描述（家庭/企业/公共WiFi）
- 服务器操作系统和版本
- 错误信息截图
- 网络诊断测试结果
